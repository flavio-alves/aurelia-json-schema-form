var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
define(["require", "exports", "aurelia-validation", "aurelia-framework", "../services/schema-form-configuration"], function (require, exports, aurelia_validation_1, aurelia_framework_1, schema_form_configuration_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var StringRules = /** @class */ (function () {
        function StringRules(configuration) {
            this.configuration = configuration;
        }
        StringRules.prototype.register = function () {
            this.add();
            this.setCustomMessages();
        };
        StringRules.prototype.setCustomMessages = function () {
            aurelia_validation_1.validationMessages.minLength = this.configuration.messages.minLength || aurelia_validation_1.validationMessages.minLength;
            aurelia_validation_1.validationMessages.maxLength = this.configuration.messages.maxLength || aurelia_validation_1.validationMessages.maxLength;
            aurelia_validation_1.validationMessages.matches = this.configuration.messages.pattern || aurelia_validation_1.validationMessages.matches;
            aurelia_validation_1.validationMessages.email = this.configuration.messages.format_email || aurelia_validation_1.validationMessages.email;
        };
        StringRules.prototype.add = function () {
            // format datetime
            // tslint:disable-next-line:max-line-length
            var iso8601Datetime = /^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i;
            aurelia_validation_1.ValidationRules
                .customRule('format_datetime', function (val) { return !!val ? iso8601Datetime.test(val) : true; }, this.configuration.messages.format_datetime || '${$displayName} is not a valid date/time.');
            // format date
            var iso8601Date = /^\d\d\d\d-[0-1]\d-[0-3]\d$/;
            aurelia_validation_1.ValidationRules
                .customRule('format_date', function (val) { return !!val ? iso8601Date.test(val) : true; }, this.configuration.messages.format_date || '${$displayName} is not a valid date.');
            // format time
            var iso8601Time = /^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i;
            aurelia_validation_1.ValidationRules
                .customRule('format_time', function (val) { return !!val ? iso8601Time.test(val) : true; }, this.configuration.messages.format_time || '${$displayName} is not a valid time.');
            // format ipv4
            var ipv4 = /^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/;
            aurelia_validation_1.ValidationRules
                .customRule('format_ipv4', function (val) { return !!val ? ipv4.test(val) : true; }, this.configuration.messages.format_ipv4 || '${$displayName} is not a valid IPv4 address.');
            // format ipv6
            // tslint:disable-next-line:max-line-length
            var ipv6 = /^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i;
            aurelia_validation_1.ValidationRules
                .customRule('format_ipv6', function (val) { return !!val ? ipv6.test(val) : true; }, this.configuration.messages.format_ipv6 || '${$displayName} is not a valid IPv6 address.');
            // format hostname
            var hostname = /^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i;
            aurelia_validation_1.ValidationRules
                .customRule('format_hostname', function (val) { return !!val ? hostname.test(val) : true; }, this.configuration.messages.format_hostname || '${$displayName} is not a valid hostname.');
            // format uri
            var uri = /^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i;
            aurelia_validation_1.ValidationRules
                .customRule('format_uri', function (val) { return !!val ? uri.test(val) : true; }, this.configuration.messages.format_uri || '${$displayName} is not a valid URI.');
            // pattern
            aurelia_validation_1.ValidationRules
                .customRule('pattern', function (val, _obj, pattern) { return !!val ? (new RegExp(pattern)).test(val) : true; }, this.configuration.messages.pattern || '${$displayName} is not correctly formatted.', function (pattern) { return ({ pattern: pattern }); });
        };
        StringRules.prototype.bind = function (ctrl, rule) {
            if (ctrl.form.$schema.pattern) {
                rule = rule.satisfiesRule('pattern', ctrl.form.$schema.pattern);
            }
            if (ctrl.form.$schema.minLength) {
                rule = rule.minLength(ctrl.form.$schema.minLength);
            }
            if (ctrl.form.$schema.maxLength) {
                rule = rule.maxLength(ctrl.form.$schema.maxLength);
            }
            if (ctrl.form.$schema.format && ctrl.form.$schema.format !== 'email') {
                var rulename = "format_" + ctrl.form.$schema.format.replace('-', '');
                rule = rule.satisfiesRule(rulename);
            }
            if (ctrl.form.$schema.format === 'email') {
                rule = rule.email();
            }
        };
        StringRules = __decorate([
            aurelia_framework_1.inject(schema_form_configuration_1.SchemaFormConfiguration),
            __metadata("design:paramtypes", [schema_form_configuration_1.SchemaFormConfiguration])
        ], StringRules);
        return StringRules;
    }());
    exports.StringRules = StringRules;
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUU7Z0JBQ3hDLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7YUFDckI7UUFDSCxDQUFDO1FBM0dVLFdBQVc7WUFEdkIsMEJBQU0sQ0FBQyxtREFBdUIsQ0FBQzs2Q0FFSyxtREFBdUI7V0FEL0MsV0FBVyxDQTRHdkI7UUFBRCxrQkFBQztLQTVHRCxBQTRHQyxJQUFBO0lBNUdZLGtDQUFXIiwiZmlsZSI6InJ1bGVzL3N0cmluZy1ydWxlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZhbGlkYXRpb25SdWxlcywgdmFsaWRhdGlvbk1lc3NhZ2VzLCBGbHVlbnRSdWxlQ3VzdG9taXplciB9IGZyb20gJ2F1cmVsaWEtdmFsaWRhdGlvbic7XHJcbmltcG9ydCB7IGluamVjdCB9IGZyb20gJ2F1cmVsaWEtZnJhbWV3b3JrJztcclxuaW1wb3J0IHsgU2NoZW1hRm9ybUNvbmZpZ3VyYXRpb24gfSBmcm9tICcuLi9zZXJ2aWNlcy9zY2hlbWEtZm9ybS1jb25maWd1cmF0aW9uJztcclxuaW1wb3J0IHsgU2ZTdHJpbmcgfSBmcm9tICcuLi9mb3JtL3RleHQvc2Ytc3RyaW5nJztcclxuXHJcbkBpbmplY3QoU2NoZW1hRm9ybUNvbmZpZ3VyYXRpb24pXHJcbmV4cG9ydCBjbGFzcyBTdHJpbmdSdWxlcyB7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjb25maWd1cmF0aW9uOiBTY2hlbWFGb3JtQ29uZmlndXJhdGlvbikgeyB9XHJcbiAgcmVnaXN0ZXIoKSB7XHJcbiAgICB0aGlzLmFkZCgpO1xyXG4gICAgdGhpcy5zZXRDdXN0b21NZXNzYWdlcygpO1xyXG4gIH1cclxuXHJcbiAgc2V0Q3VzdG9tTWVzc2FnZXMoKSB7XHJcbiAgICB2YWxpZGF0aW9uTWVzc2FnZXMubWluTGVuZ3RoID0gdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLm1pbkxlbmd0aCB8fCB2YWxpZGF0aW9uTWVzc2FnZXMubWluTGVuZ3RoO1xyXG4gICAgdmFsaWRhdGlvbk1lc3NhZ2VzLm1heExlbmd0aCA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5tYXhMZW5ndGggfHwgdmFsaWRhdGlvbk1lc3NhZ2VzLm1heExlbmd0aDtcclxuICAgIHZhbGlkYXRpb25NZXNzYWdlcy5tYXRjaGVzID0gdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLnBhdHRlcm4gfHwgdmFsaWRhdGlvbk1lc3NhZ2VzLm1hdGNoZXM7XHJcbiAgICB2YWxpZGF0aW9uTWVzc2FnZXMuZW1haWwgPSB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X2VtYWlsIHx8IHZhbGlkYXRpb25NZXNzYWdlcy5lbWFpbDtcclxuICB9XHJcblxyXG4gIGFkZCgpIHtcclxuICAgIC8vIGZvcm1hdCBkYXRldGltZVxyXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxyXG4gICAgY29uc3QgaXNvODYwMURhdGV0aW1lID0gL15cXGRcXGRcXGRcXGQtWzAtMV1cXGQtWzAtM11cXGRbdFxcc10oPzpbMC0yXVxcZDpbMC01XVxcZDpbMC01XVxcZHwyMzo1OTo2MCkoPzpcXC5cXGQrKT8oPzp6fFsrLV1cXGRcXGQ6XFxkXFxkKSQvaTtcclxuICAgIFZhbGlkYXRpb25SdWxlc1xyXG4gICAgICAuY3VzdG9tUnVsZShcclxuICAgICAgICAnZm9ybWF0X2RhdGV0aW1lJyxcclxuICAgICAgICAodmFsOiBzdHJpbmcpID0+ICEhdmFsID8gaXNvODYwMURhdGV0aW1lLnRlc3QodmFsKSA6IHRydWUsXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9kYXRldGltZSB8fCAnJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIGRhdGUvdGltZS4nXHJcbiAgICAgICk7XHJcblxyXG4gICAgLy8gZm9ybWF0IGRhdGVcclxuICAgIGNvbnN0IGlzbzg2MDFEYXRlID0gL15cXGRcXGRcXGRcXGQtWzAtMV1cXGQtWzAtM11cXGQkLztcclxuICAgIFZhbGlkYXRpb25SdWxlc1xyXG4gICAgICAuY3VzdG9tUnVsZShcclxuICAgICAgICAnZm9ybWF0X2RhdGUnLFxyXG4gICAgICAgICh2YWw6IHN0cmluZykgPT4gISF2YWwgPyBpc284NjAxRGF0ZS50ZXN0KHZhbCkgOiB0cnVlLFxyXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfZGF0ZSB8fCAnJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIGRhdGUuJ1xyXG4gICAgICApO1xyXG5cclxuICAgIC8vIGZvcm1hdCB0aW1lXHJcbiAgICBjb25zdCBpc284NjAxVGltZSA9IC9eKD86WzAtMl1cXGQ6WzAtNV1cXGQ6WzAtNV1cXGR8MjM6NTk6NjApKD86XFwuXFxkKyk/KD86enxbKy1dXFxkXFxkOlxcZFxcZCk/JC9pO1xyXG4gICAgVmFsaWRhdGlvblJ1bGVzXHJcbiAgICAgIC5jdXN0b21SdWxlKFxyXG4gICAgICAgICdmb3JtYXRfdGltZScsXHJcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiAhIXZhbCA/IGlzbzg2MDFUaW1lLnRlc3QodmFsKSA6IHRydWUsXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF90aW1lIHx8ICckeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgdGltZS4nXHJcbiAgICAgICk7XHJcblxyXG4gICAgLy8gZm9ybWF0IGlwdjRcclxuICAgIGNvbnN0IGlwdjQgPSAvXig/Oig/OjI1WzAtNV18MlswLTRdXFxkfFswMV0/XFxkXFxkPylcXC4pezN9KD86MjVbMC01XXwyWzAtNF1cXGR8WzAxXT9cXGRcXGQ/KSQvO1xyXG4gICAgVmFsaWRhdGlvblJ1bGVzXHJcbiAgICAgIC5jdXN0b21SdWxlKFxyXG4gICAgICAgICdmb3JtYXRfaXB2NCcsXHJcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiAhIXZhbCA/IGlwdjQudGVzdCh2YWwpIDogdHJ1ZSxcclxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X2lwdjQgfHwgJyR7JGRpc3BsYXlOYW1lfSBpcyBub3QgYSB2YWxpZCBJUHY0IGFkZHJlc3MuJ1xyXG4gICAgICApO1xyXG5cclxuICAgIC8vIGZvcm1hdCBpcHY2XHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgICBjb25zdCBpcHY2ID0gL15cXHMqKD86KD86KD86WzAtOWEtZl17MSw0fTopezd9KD86WzAtOWEtZl17MSw0fXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezZ9KD86OlswLTlhLWZdezEsNH18KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSl8OikpfCg/Oig/OlswLTlhLWZdezEsNH06KXs1fSg/Oig/Oig/OjpbMC05YS1mXXsxLDR9KXsxLDJ9KXw6KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSl8OikpfCg/Oig/OlswLTlhLWZdezEsNH06KXs0fSg/Oig/Oig/OjpbMC05YS1mXXsxLDR9KXsxLDN9KXwoPzooPzo6WzAtOWEtZl17MSw0fSk/Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pKXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezN9KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsNH0pfCg/Oig/OjpbMC05YS1mXXsxLDR9KXswLDJ9Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pKXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezJ9KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsNX0pfCg/Oig/OjpbMC05YS1mXXsxLDR9KXswLDN9Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pKXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezF9KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsNn0pfCg/Oig/OjpbMC05YS1mXXsxLDR9KXswLDR9Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pKXw6KSl8KD86Oig/Oig/Oig/OjpbMC05YS1mXXsxLDR9KXsxLDd9KXwoPzooPzo6WzAtOWEtZl17MSw0fSl7MCw1fTooPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkpezN9KSl8OikpKSg/OiUuKyk/XFxzKiQvaTtcclxuICAgIFZhbGlkYXRpb25SdWxlc1xyXG4gICAgICAuY3VzdG9tUnVsZShcclxuICAgICAgICAnZm9ybWF0X2lwdjYnLFxyXG4gICAgICAgICh2YWw6IHN0cmluZykgPT4gISF2YWwgPyBpcHY2LnRlc3QodmFsKSA6IHRydWUsXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9pcHY2IHx8ICckeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgSVB2NiBhZGRyZXNzLidcclxuICAgICAgKTtcclxuXHJcbiAgICAvLyBmb3JtYXQgaG9zdG5hbWVcclxuICAgIGNvbnN0IGhvc3RuYW1lID0gL15bYS16MC05XSg/OlthLXowLTktXXswLDYxfVthLXowLTldKT8oPzpcXC5bYS16MC05XSg/OlstMC05YS16XXswLDYxfVswLTlhLXpdKT8pKiQvaTtcclxuICAgIFZhbGlkYXRpb25SdWxlc1xyXG4gICAgICAuY3VzdG9tUnVsZShcclxuICAgICAgICAnZm9ybWF0X2hvc3RuYW1lJyxcclxuICAgICAgICAodmFsOiBzdHJpbmcpID0+ICEhdmFsID8gaG9zdG5hbWUudGVzdCh2YWwpIDogdHJ1ZSxcclxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X2hvc3RuYW1lIHx8ICckeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgaG9zdG5hbWUuJ1xyXG4gICAgICApO1xyXG5cclxuICAgIC8vIGZvcm1hdCB1cmlcclxuICAgIGNvbnN0IHVyaSA9IC9eKD86W2Etel1bYS16MC05Ky0uXSo6KSg/OlxcLz9cXC8pP1teXFxzXSokL2k7XHJcbiAgICBWYWxpZGF0aW9uUnVsZXNcclxuICAgICAgLmN1c3RvbVJ1bGUoXHJcbiAgICAgICAgJ2Zvcm1hdF91cmknLFxyXG4gICAgICAgICh2YWw6IHN0cmluZykgPT4gISF2YWwgPyB1cmkudGVzdCh2YWwpIDogdHJ1ZSxcclxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X3VyaSB8fCAnJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIFVSSS4nXHJcbiAgICAgICk7XHJcblxyXG4gICAgLy8gcGF0dGVyblxyXG4gICAgVmFsaWRhdGlvblJ1bGVzXHJcbiAgICAgIC5jdXN0b21SdWxlKFxyXG4gICAgICAgICdwYXR0ZXJuJyxcclxuICAgICAgICAodmFsLCBfb2JqLCBwYXR0ZXJuKSA9PiAhIXZhbCA/IChuZXcgUmVnRXhwKHBhdHRlcm4pKS50ZXN0KHZhbCkgOiB0cnVlLFxyXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5wYXR0ZXJuIHx8ICckeyRkaXNwbGF5TmFtZX0gaXMgbm90IGNvcnJlY3RseSBmb3JtYXR0ZWQuJyxcclxuICAgICAgICAocGF0dGVybikgPT4gKHsgcGF0dGVybiB9KVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgYmluZChjdHJsOiBTZlN0cmluZywgcnVsZTogRmx1ZW50UnVsZUN1c3RvbWl6ZXI8e30sIGFueT4pIHtcclxuICAgIGlmIChjdHJsLmZvcm0uJHNjaGVtYS5wYXR0ZXJuKSB7XHJcbiAgICAgIHJ1bGUgPSBydWxlLnNhdGlzZmllc1J1bGUoJ3BhdHRlcm4nLCBjdHJsLmZvcm0uJHNjaGVtYS5wYXR0ZXJuKTtcclxuICAgIH1cclxuICAgIGlmIChjdHJsLmZvcm0uJHNjaGVtYS5taW5MZW5ndGgpIHtcclxuICAgICAgcnVsZSA9IHJ1bGUubWluTGVuZ3RoKGN0cmwuZm9ybS4kc2NoZW1hLm1pbkxlbmd0aCk7XHJcbiAgICB9XHJcbiAgICBpZiAoY3RybC5mb3JtLiRzY2hlbWEubWF4TGVuZ3RoKSB7XHJcbiAgICAgIHJ1bGUgPSBydWxlLm1heExlbmd0aChjdHJsLmZvcm0uJHNjaGVtYS5tYXhMZW5ndGgpO1xyXG4gICAgfVxyXG4gICAgaWYgKGN0cmwuZm9ybS4kc2NoZW1hLmZvcm1hdCAmJiBjdHJsLmZvcm0uJHNjaGVtYS5mb3JtYXQgIT09ICdlbWFpbCcpIHtcclxuICAgICAgY29uc3QgcnVsZW5hbWUgPSBgZm9ybWF0XyR7Y3RybC5mb3JtLiRzY2hlbWEuZm9ybWF0LnJlcGxhY2UoJy0nLCAnJyl9YDtcclxuICAgICAgcnVsZSA9IHJ1bGUuc2F0aXNmaWVzUnVsZShydWxlbmFtZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoY3RybC5mb3JtLiRzY2hlbWEuZm9ybWF0ID09PSAnZW1haWwnKSB7XHJcbiAgICAgIHJ1bGUgPSBydWxlLmVtYWlsKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdLCJzb3VyY2VSb290Ijoic3JjL3BsdWdpbiJ9
