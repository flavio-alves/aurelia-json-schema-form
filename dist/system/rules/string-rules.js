System.register(["aurelia-validation", "aurelia-framework", "../services/schema-form-configuration"], function (exports_1, context_1) {
    "use strict";
    var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
        var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
        if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
        else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
        return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var __metadata = (this && this.__metadata) || function (k, v) {
        if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
    };
    var aurelia_validation_1, aurelia_framework_1, schema_form_configuration_1, StringRules;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (aurelia_validation_1_1) {
                aurelia_validation_1 = aurelia_validation_1_1;
            },
            function (aurelia_framework_1_1) {
                aurelia_framework_1 = aurelia_framework_1_1;
            },
            function (schema_form_configuration_1_1) {
                schema_form_configuration_1 = schema_form_configuration_1_1;
            }
        ],
        execute: function () {
            StringRules = /** @class */ (function () {
                function StringRules(configuration) {
                    this.configuration = configuration;
                }
                StringRules.prototype.register = function () {
                    this.add();
                    this.setCustomMessages();
                };
                StringRules.prototype.setCustomMessages = function () {
                    aurelia_validation_1.validationMessages.minLength = this.configuration.messages.minLength || aurelia_validation_1.validationMessages.minLength;
                    aurelia_validation_1.validationMessages.maxLength = this.configuration.messages.maxLength || aurelia_validation_1.validationMessages.maxLength;
                    aurelia_validation_1.validationMessages.matches = this.configuration.messages.pattern || aurelia_validation_1.validationMessages.matches;
                    aurelia_validation_1.validationMessages.email = this.configuration.messages.format_email || aurelia_validation_1.validationMessages.email;
                };
                StringRules.prototype.add = function () {
                    // format datetime
                    // tslint:disable-next-line:max-line-length
                    var iso8601Datetime = /^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i;
                    aurelia_validation_1.ValidationRules
                        .customRule('format_datetime', function (val) { return !!val ? iso8601Datetime.test(val) : true; }, this.configuration.messages.format_datetime || '${$displayName} is not a valid date/time.');
                    // format date
                    var iso8601Date = /^\d\d\d\d-[0-1]\d-[0-3]\d$/;
                    aurelia_validation_1.ValidationRules
                        .customRule('format_date', function (val) { return !!val ? iso8601Date.test(val) : true; }, this.configuration.messages.format_date || '${$displayName} is not a valid date.');
                    // format time
                    var iso8601Time = /^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i;
                    aurelia_validation_1.ValidationRules
                        .customRule('format_time', function (val) { return !!val ? iso8601Time.test(val) : true; }, this.configuration.messages.format_time || '${$displayName} is not a valid time.');
                    // format ipv4
                    var ipv4 = /^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/;
                    aurelia_validation_1.ValidationRules
                        .customRule('format_ipv4', function (val) { return !!val ? ipv4.test(val) : true; }, this.configuration.messages.format_ipv4 || '${$displayName} is not a valid IPv4 address.');
                    // format ipv6
                    // tslint:disable-next-line:max-line-length
                    var ipv6 = /^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i;
                    aurelia_validation_1.ValidationRules
                        .customRule('format_ipv6', function (val) { return !!val ? ipv6.test(val) : true; }, this.configuration.messages.format_ipv6 || '${$displayName} is not a valid IPv6 address.');
                    // format hostname
                    var hostname = /^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i;
                    aurelia_validation_1.ValidationRules
                        .customRule('format_hostname', function (val) { return !!val ? hostname.test(val) : true; }, this.configuration.messages.format_hostname || '${$displayName} is not a valid hostname.');
                    // format uri
                    var uri = /^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i;
                    aurelia_validation_1.ValidationRules
                        .customRule('format_uri', function (val) { return !!val ? uri.test(val) : true; }, this.configuration.messages.format_uri || '${$displayName} is not a valid URI.');
                    // pattern
                    aurelia_validation_1.ValidationRules
                        .customRule('pattern', function (val, _obj, pattern) { return !!val ? (new RegExp(pattern)).test(val) : true; }, this.configuration.messages.pattern || '${$displayName} is not correctly formatted.', function (pattern) { return ({ pattern: pattern }); });
                };
                StringRules.prototype.bind = function (ctrl, rule) {
                    if (ctrl.form.$schema.pattern) {
                        rule = rule.satisfiesRule('pattern', ctrl.form.$schema.pattern);
                    }
                    if (ctrl.form.$schema.minLength) {
                        rule = rule.minLength(ctrl.form.$schema.minLength);
                    }
                    if (ctrl.form.$schema.maxLength) {
                        rule = rule.maxLength(ctrl.form.$schema.maxLength);
                    }
                    if (ctrl.form.$schema.format && ctrl.form.$schema.format !== 'email') {
                        var rulename = "format_" + ctrl.form.$schema.format.replace('-', '');
                        rule = rule.satisfiesRule(rulename);
                    }
                    if (ctrl.form.$schema.format === 'email') {
                        rule = rule.email();
                    }
                };
                StringRules = __decorate([
                    aurelia_framework_1.inject(schema_form_configuration_1.SchemaFormConfiguration),
                    __metadata("design:paramtypes", [schema_form_configuration_1.SchemaFormConfiguration])
                ], StringRules);
                return StringRules;
            }());
            exports_1("StringRules", StringRules);
        }
    };
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QztvQkFDRCxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sS0FBSyxPQUFPLEVBQUU7d0JBQ3hDLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7cUJBQ3JCO2dCQUNILENBQUM7Z0JBM0dVLFdBQVc7b0JBRHZCLDBCQUFNLENBQUMsbURBQXVCLENBQUM7cURBRUssbURBQXVCO21CQUQvQyxXQUFXLENBNEd2QjtnQkFBRCxrQkFBQzthQTVHRCxBQTRHQzs7UUFDRCxDQUFDIiwiZmlsZSI6InJ1bGVzL3N0cmluZy1ydWxlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZhbGlkYXRpb25SdWxlcywgdmFsaWRhdGlvbk1lc3NhZ2VzLCBGbHVlbnRSdWxlQ3VzdG9taXplciB9IGZyb20gJ2F1cmVsaWEtdmFsaWRhdGlvbic7XG5pbXBvcnQgeyBpbmplY3QgfSBmcm9tICdhdXJlbGlhLWZyYW1ld29yayc7XG5pbXBvcnQgeyBTY2hlbWFGb3JtQ29uZmlndXJhdGlvbiB9IGZyb20gJy4uL3NlcnZpY2VzL3NjaGVtYS1mb3JtLWNvbmZpZ3VyYXRpb24nO1xuaW1wb3J0IHsgU2ZTdHJpbmcgfSBmcm9tICcuLi9mb3JtL3RleHQvc2Ytc3RyaW5nJztcblxuQGluamVjdChTY2hlbWFGb3JtQ29uZmlndXJhdGlvbilcbmV4cG9ydCBjbGFzcyBTdHJpbmdSdWxlcyB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY29uZmlndXJhdGlvbjogU2NoZW1hRm9ybUNvbmZpZ3VyYXRpb24pIHsgfVxuICByZWdpc3RlcigpIHtcbiAgICB0aGlzLmFkZCgpO1xuICAgIHRoaXMuc2V0Q3VzdG9tTWVzc2FnZXMoKTtcbiAgfVxuXG4gIHNldEN1c3RvbU1lc3NhZ2VzKCkge1xuICAgIHZhbGlkYXRpb25NZXNzYWdlcy5taW5MZW5ndGggPSB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMubWluTGVuZ3RoIHx8IHZhbGlkYXRpb25NZXNzYWdlcy5taW5MZW5ndGg7XG4gICAgdmFsaWRhdGlvbk1lc3NhZ2VzLm1heExlbmd0aCA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5tYXhMZW5ndGggfHwgdmFsaWRhdGlvbk1lc3NhZ2VzLm1heExlbmd0aDtcbiAgICB2YWxpZGF0aW9uTWVzc2FnZXMubWF0Y2hlcyA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5wYXR0ZXJuIHx8IHZhbGlkYXRpb25NZXNzYWdlcy5tYXRjaGVzO1xuICAgIHZhbGlkYXRpb25NZXNzYWdlcy5lbWFpbCA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfZW1haWwgfHwgdmFsaWRhdGlvbk1lc3NhZ2VzLmVtYWlsO1xuICB9XG5cbiAgYWRkKCkge1xuICAgIC8vIGZvcm1hdCBkYXRldGltZVxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcbiAgICBjb25zdCBpc284NjAxRGF0ZXRpbWUgPSAvXlxcZFxcZFxcZFxcZC1bMC0xXVxcZC1bMC0zXVxcZFt0XFxzXSg/OlswLTJdXFxkOlswLTVdXFxkOlswLTVdXFxkfDIzOjU5OjYwKSg/OlxcLlxcZCspPyg/Onp8WystXVxcZFxcZDpcXGRcXGQpJC9pO1xuICAgIFZhbGlkYXRpb25SdWxlc1xuICAgICAgLmN1c3RvbVJ1bGUoXG4gICAgICAgICdmb3JtYXRfZGF0ZXRpbWUnLFxuICAgICAgICAodmFsOiBzdHJpbmcpID0+ICEhdmFsID8gaXNvODYwMURhdGV0aW1lLnRlc3QodmFsKSA6IHRydWUsXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfZGF0ZXRpbWUgfHwgJyR7JGRpc3BsYXlOYW1lfSBpcyBub3QgYSB2YWxpZCBkYXRlL3RpbWUuJ1xuICAgICAgKTtcblxuICAgIC8vIGZvcm1hdCBkYXRlXG4gICAgY29uc3QgaXNvODYwMURhdGUgPSAvXlxcZFxcZFxcZFxcZC1bMC0xXVxcZC1bMC0zXVxcZCQvO1xuICAgIFZhbGlkYXRpb25SdWxlc1xuICAgICAgLmN1c3RvbVJ1bGUoXG4gICAgICAgICdmb3JtYXRfZGF0ZScsXG4gICAgICAgICh2YWw6IHN0cmluZykgPT4gISF2YWwgPyBpc284NjAxRGF0ZS50ZXN0KHZhbCkgOiB0cnVlLFxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X2RhdGUgfHwgJyR7JGRpc3BsYXlOYW1lfSBpcyBub3QgYSB2YWxpZCBkYXRlLidcbiAgICAgICk7XG5cbiAgICAvLyBmb3JtYXQgdGltZVxuICAgIGNvbnN0IGlzbzg2MDFUaW1lID0gL14oPzpbMC0yXVxcZDpbMC01XVxcZDpbMC01XVxcZHwyMzo1OTo2MCkoPzpcXC5cXGQrKT8oPzp6fFsrLV1cXGRcXGQ6XFxkXFxkKT8kL2k7XG4gICAgVmFsaWRhdGlvblJ1bGVzXG4gICAgICAuY3VzdG9tUnVsZShcbiAgICAgICAgJ2Zvcm1hdF90aW1lJyxcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiAhIXZhbCA/IGlzbzg2MDFUaW1lLnRlc3QodmFsKSA6IHRydWUsXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfdGltZSB8fCAnJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIHRpbWUuJ1xuICAgICAgKTtcblxuICAgIC8vIGZvcm1hdCBpcHY0XG4gICAgY29uc3QgaXB2NCA9IC9eKD86KD86MjVbMC01XXwyWzAtNF1cXGR8WzAxXT9cXGRcXGQ/KVxcLil7M30oPzoyNVswLTVdfDJbMC00XVxcZHxbMDFdP1xcZFxcZD8pJC87XG4gICAgVmFsaWRhdGlvblJ1bGVzXG4gICAgICAuY3VzdG9tUnVsZShcbiAgICAgICAgJ2Zvcm1hdF9pcHY0JyxcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiAhIXZhbCA/IGlwdjQudGVzdCh2YWwpIDogdHJ1ZSxcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9pcHY0IHx8ICckeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgSVB2NCBhZGRyZXNzLidcbiAgICAgICk7XG5cbiAgICAvLyBmb3JtYXQgaXB2NlxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcbiAgICBjb25zdCBpcHY2ID0gL15cXHMqKD86KD86KD86WzAtOWEtZl17MSw0fTopezd9KD86WzAtOWEtZl17MSw0fXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezZ9KD86OlswLTlhLWZdezEsNH18KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSl8OikpfCg/Oig/OlswLTlhLWZdezEsNH06KXs1fSg/Oig/Oig/OjpbMC05YS1mXXsxLDR9KXsxLDJ9KXw6KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSl8OikpfCg/Oig/OlswLTlhLWZdezEsNH06KXs0fSg/Oig/Oig/OjpbMC05YS1mXXsxLDR9KXsxLDN9KXwoPzooPzo6WzAtOWEtZl17MSw0fSk/Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pKXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezN9KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsNH0pfCg/Oig/OjpbMC05YS1mXXsxLDR9KXswLDJ9Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pKXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezJ9KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsNX0pfCg/Oig/OjpbMC05YS1mXXsxLDR9KXswLDN9Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pKXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezF9KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsNn0pfCg/Oig/OjpbMC05YS1mXXsxLDR9KXswLDR9Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pKXw6KSl8KD86Oig/Oig/Oig/OjpbMC05YS1mXXsxLDR9KXsxLDd9KXwoPzooPzo6WzAtOWEtZl17MSw0fSl7MCw1fTooPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkpezN9KSl8OikpKSg/OiUuKyk/XFxzKiQvaTtcbiAgICBWYWxpZGF0aW9uUnVsZXNcbiAgICAgIC5jdXN0b21SdWxlKFxuICAgICAgICAnZm9ybWF0X2lwdjYnLFxuICAgICAgICAodmFsOiBzdHJpbmcpID0+ICEhdmFsID8gaXB2Ni50ZXN0KHZhbCkgOiB0cnVlLFxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X2lwdjYgfHwgJyR7JGRpc3BsYXlOYW1lfSBpcyBub3QgYSB2YWxpZCBJUHY2IGFkZHJlc3MuJ1xuICAgICAgKTtcblxuICAgIC8vIGZvcm1hdCBob3N0bmFtZVxuICAgIGNvbnN0IGhvc3RuYW1lID0gL15bYS16MC05XSg/OlthLXowLTktXXswLDYxfVthLXowLTldKT8oPzpcXC5bYS16MC05XSg/OlstMC05YS16XXswLDYxfVswLTlhLXpdKT8pKiQvaTtcbiAgICBWYWxpZGF0aW9uUnVsZXNcbiAgICAgIC5jdXN0b21SdWxlKFxuICAgICAgICAnZm9ybWF0X2hvc3RuYW1lJyxcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiAhIXZhbCA/IGhvc3RuYW1lLnRlc3QodmFsKSA6IHRydWUsXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfaG9zdG5hbWUgfHwgJyR7JGRpc3BsYXlOYW1lfSBpcyBub3QgYSB2YWxpZCBob3N0bmFtZS4nXG4gICAgICApO1xuXG4gICAgLy8gZm9ybWF0IHVyaVxuICAgIGNvbnN0IHVyaSA9IC9eKD86W2Etel1bYS16MC05Ky0uXSo6KSg/OlxcLz9cXC8pP1teXFxzXSokL2k7XG4gICAgVmFsaWRhdGlvblJ1bGVzXG4gICAgICAuY3VzdG9tUnVsZShcbiAgICAgICAgJ2Zvcm1hdF91cmknLFxuICAgICAgICAodmFsOiBzdHJpbmcpID0+ICEhdmFsID8gdXJpLnRlc3QodmFsKSA6IHRydWUsXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfdXJpIHx8ICckeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgVVJJLidcbiAgICAgICk7XG5cbiAgICAvLyBwYXR0ZXJuXG4gICAgVmFsaWRhdGlvblJ1bGVzXG4gICAgICAuY3VzdG9tUnVsZShcbiAgICAgICAgJ3BhdHRlcm4nLFxuICAgICAgICAodmFsLCBfb2JqLCBwYXR0ZXJuKSA9PiAhIXZhbCA/IChuZXcgUmVnRXhwKHBhdHRlcm4pKS50ZXN0KHZhbCkgOiB0cnVlLFxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMucGF0dGVybiB8fCAnJHskZGlzcGxheU5hbWV9IGlzIG5vdCBjb3JyZWN0bHkgZm9ybWF0dGVkLicsXG4gICAgICAgIChwYXR0ZXJuKSA9PiAoeyBwYXR0ZXJuIH0pXG4gICAgICApO1xuICB9XG5cbiAgYmluZChjdHJsOiBTZlN0cmluZywgcnVsZTogRmx1ZW50UnVsZUN1c3RvbWl6ZXI8e30sIGFueT4pIHtcbiAgICBpZiAoY3RybC5mb3JtLiRzY2hlbWEucGF0dGVybikge1xuICAgICAgcnVsZSA9IHJ1bGUuc2F0aXNmaWVzUnVsZSgncGF0dGVybicsIGN0cmwuZm9ybS4kc2NoZW1hLnBhdHRlcm4pO1xuICAgIH1cbiAgICBpZiAoY3RybC5mb3JtLiRzY2hlbWEubWluTGVuZ3RoKSB7XG4gICAgICBydWxlID0gcnVsZS5taW5MZW5ndGgoY3RybC5mb3JtLiRzY2hlbWEubWluTGVuZ3RoKTtcbiAgICB9XG4gICAgaWYgKGN0cmwuZm9ybS4kc2NoZW1hLm1heExlbmd0aCkge1xuICAgICAgcnVsZSA9IHJ1bGUubWF4TGVuZ3RoKGN0cmwuZm9ybS4kc2NoZW1hLm1heExlbmd0aCk7XG4gICAgfVxuICAgIGlmIChjdHJsLmZvcm0uJHNjaGVtYS5mb3JtYXQgJiYgY3RybC5mb3JtLiRzY2hlbWEuZm9ybWF0ICE9PSAnZW1haWwnKSB7XG4gICAgICBjb25zdCBydWxlbmFtZSA9IGBmb3JtYXRfJHtjdHJsLmZvcm0uJHNjaGVtYS5mb3JtYXQucmVwbGFjZSgnLScsICcnKX1gO1xuICAgICAgcnVsZSA9IHJ1bGUuc2F0aXNmaWVzUnVsZShydWxlbmFtZSk7XG4gICAgfVxuICAgIGlmIChjdHJsLmZvcm0uJHNjaGVtYS5mb3JtYXQgPT09ICdlbWFpbCcpIHtcbiAgICAgIHJ1bGUgPSBydWxlLmVtYWlsKCk7XG4gICAgfVxuICB9XG59XG4iXSwic291cmNlUm9vdCI6InNyYy9wbHVnaW4ifQ==
